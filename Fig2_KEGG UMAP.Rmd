---
title: "Fig2_KEGG UMAP"
author: "Qiuyun Yang"
date: "`r Sys.Date()`"
output: html_document
---

library(msigdbr)
m_df<- msigdbr(species = "Mus musculus",  category = "C2", subcategory = "KEGG")
fgsea_sets<- m_df %>% split(x = .$gene_symbol, f = .$gs_name)

cells_AUC <- AUCell_calcAUC(fgsea_sets, cells_rankings,nCores =1, aucMaxRank=nrow(cells_rankings)*0.1)

geneSet <- "KEGG_NUCLEOTIDE EXCISION REPAIR"
geneSet <- "KEGG_LONG-TERM POTENTIATION"
geneSet <- "KEGG_PPAR SIGNALING PATHWAY"
geneSet <- "KEGG_HISTIDINE METABOLISM"
aucs <- as.numeric(getAUC(cells_AUC)[geneSet, ])
immune.combined.sct$AUC <- aucs
df<- data.frame(immune.combined.sct@meta.data, immune.combined.sct@reductions$umap@cell.embeddings)
#colnames(df)
class_avg <- df %>%
  group_by( seurat_clusters) %>%
  summarise(
    UMAP_1 = median(UMAP_1),
    UMAP_2 = median(UMAP_2)